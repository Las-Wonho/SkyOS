# 우리는 흑마법사

나는 처음에 직접 코딩을 할 때 이게 뭐하는건지 몰랐어. 얘를들어 APM이라거나... (Application Performance Management 아니야. 애플 파티션 맵도 아니야) 그런 이상한 애들을 알기 위하여 구글링을 내가 대신 했어. 그러니까 개발을 하다가 생긴 궁금증을 넣었다는 거지. 

## 멀티 부트 헤더파일

우리가 먼저 작성해야 하는 파일이지. 그래서 그런지 모르는게 너무 많이 나와. 예제가 있다고 하지만 설명이 자세하지는 않더라고. 그래서 내가 간단하게 설명을 하고 링크나 자료를 줄게.

### APMTable
얘가 뭐하는걸까? 진짜 검색해도 잘 안나오는데 이 APM은 Advanced Power Management라는 뜻이야. 진짜 이 뜻을 왜 줄여쓰는지... 근데 사실 그렇게 중요한 아이는 아니라서 넘어간거야.

### ELFHeaderTable
이건 구글링 하면 바로 나와. 꽤 자세히 나오니까 그거 보면 좋아

### AOUTSymbolTable
그마나 나오기는 했던 녀석인데 The symbol table for a.out이라는 설명이 있어. (노답) 그러니까 그냥 넣어둔 녀석같아.

## 구현체
우리의 SkyOS도 구현체가 있지만 다른 구현체도 있고 그게 설명도 더 자세히 되어 있어. 근데 스텝스텝 설명이 된건 아니라서 진짜 최고급 마법사는 그걸 보는게 나을 수도 있어. 관계도도 그려주고 내용은 비슷해보여(이쪽이 나중에 만들어서 구조화는 잘 되어있는듯)
[링크](http://www.freenos.org/doxygen/index-2.html)를 보면 간단한 설명이 되어있고 파일별로 설명도 되어있어. c++로 만들었으니까 대강 비슷할 것 같아(이걸 참고 했을 가능성이 크다) 근데 소스가 조금 그렇다.
[구현체](http://www.brokenthorn.com/Resources/)가 같이 나오는게 있긴 하다. 여기도 설명이 잘 되어있기때문에 좋다. 그리고 설명도 더 잘나오는건 기분탓... 그런데 여기도 조금 예전 코드같다. 그래도 보기 힘들지는 않다. 같이 보는 것을 추천한다. 그런데 미완성이다. (역시 우리의 희망 스카이!)

## 구현을 하면서 생기는 문제들

### GRUB부팅 설정

GRUB을 쓰는데 EXE랑 map을 항상 SkyOs32.EXE로 하는게 너무 불필요한 처리이다. 그렇기 때문에 해결방법이 있다. 이러한 파일을 지정해 주는 설정파일이 있다. 
*.IMA파일을 winimage로 연다음에 boot/grub/munu.lst파일을 수정해 주면 된다. 여기에 있는 exe랑 map을 바꾸면 된다. map파일도 중요하기때문에 같이 넣어주어야 한다.

### 비주얼 설정 충돌

비주얼로 돌리려고 하면 에러가 많이 뜬다. 이러한 설정을 해줘야 하는데 너무 빡치는 내용들이 많고 우리가 비우얼 스튜디오를 공부해야 하는건 아니니까 몇개만 소개한다. 사실 예제의 솔루션 파일을 복사하여 사용하는 것이 좋다.

- 일반
    - 프로젝트 기본값
        - 구성형식 = 응용프로그램(EXE)
    - SDK 버전 = 10.0.16299.0
    - 대상 확장명 = .EXE


- C/C++
    - 일반
        - 추가포함 디렉터리
            - 여기에는 Include와 CommonLib을 넣어준다.
            - C언어의 함수를 사용하기 위함이다.
        - 디버그 정보 형식 = 프로그램 데이터베이스(/Zi)
        - 내 코드만 디버깅 지원 = No
        - 경고수준 = 수준4(/W4)
    - 최적화
        - 최적화 = 사용안함
        - 인라인 함수 확장 = 기본
        - 내장함수 사용 = No
        - 크기 또는 속도 = 모두 안함
        - 프레임 포인터 생략 = Yes
        -프로그램 전체 최적화 = No
    - 전처리기
        - 전처리기 정의 = DEBUG;ARCH_X86;%(PreprocessorDefinitions);
        - 주석유지 = No
        - 표준 포함 경로 무시 = Yes
    - 코드 생성
        - C++ 예외처리 가능 = No
        - 기본 런타임 검사 = 기본값
        - 런타임 라이브러리 = 다중 스레드 DLL(/MD)
        - 구조체 멤버 맞춤 = 1바이트(/Zp1)
        - 보안검사 = 사용안함
        - 함수수준 링크 사용 = Yes
    - 언어
        - 런타임 형식 정보 사용 = No(/GR-)
        - 준수 모드 = No
    - 미리 컴파일된 헤더 사용 안함
    - 고급
        - 호출 규칙 = __cdecl(/Gd)
        - 컴파일 옵션 = 기본값
        - 특정 경고 사용 안함 = 4457;4189;4100;4702;4102;4244
    - 모든 옵션 
        - 추가 옵션 = /Oy %(AdditionalOptions)
        - 특성 사용 소스 확장 = No
- 링커 
    - 일반
        - 증분 링크 사용 = 아니요(/INCREMENTAL:NO)
        - 추가 라이브러리 디렉터리 = CommonLib.lib가 있는 Debug폴더
        - 라이브러리 종속성 링크 = Yes
    - 입력
        - 추가 종속성 = CommonLib.lib
        - 모든 기본 라이브러리 무시 = Yes
    - 메니페스트 파일
        - 메니페스트 생성 = 아니요(/MANIFEST:NO)
    - 디버깅
         - 디버그 정보 생성 = No
         - 맵파일 생성 = 예(/MAP)
         - 프로그램 데이터베이스 파일 생성 = $(OutDir)$(TargetName).pdb
         - 멥파일 이름 = $(OutDir)$(TargetName).map
    - 시스템
        - 하위 시스템 = 콘솔(/SUBSYSTEM:CONSOLE)
        - 드라이버 = 설정 안 함
    - 최적화
        - 참조 = 예(/OPT:REF)
        - COMDAT 정리 사용 = 예(/OPT:ICF)
        - 함수 순서 = @order.txt //이건 책에 나와있는 함수 리스트
    - 고급
        - 진입점 = multiboot_entry
        - 진입점 없음 = No
        - 기준 주소 = 0x00100000
        - 임의 기준 주소 = 아니요(/DYNAMICBASE:NO)
        - 이미지에 안전한 예외 처리기 포함 = 예(/SAFESEH)
    - 명령줄
        - /safeseh:no
        - /ALIGN:1024
        - /SUBSYSTEM:CONSOLE
        - /NODEFAULTLIB:LIBC 